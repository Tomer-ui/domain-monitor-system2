jenkins:
  systemMessage: "Managed by JCasC and Ansible"
  numExecutors: 0
  mode: EXCLUSIVE
  slaveAgentPort: 50000
  securityRealm:
    local:
      allowsSignup: false
      users:
       - id: "admin"
         password: "${JENKINS_ADMIN_PASSWORD}"
  authorizationStrategy:
    loggedInUsersCanDoAnything:
      allowAnonymousRead: true
  
  nodes:
  - permanent:
      # CRITICAL: This must match the 'agent' label in your Jenkinsfile
      labelString: "docker-worker" 
      mode: NORMAL
      name: "jenkins-node-1"
      numExecutors: 2
      remoteFS: "/home/jenkins"
      launcher:
        jnlp:
          workDirSettings:
            disabled: true
            failIfWorkDirIsMissing: false
            internalDir: "remoting"
            workDirPath: "/tmp"

# NEW: Automatically create the credentials needed by the Pipeline
credentials:
  system:
    domainCredentials:
      - credentials:
          # Used for 'docker login' in the pipeline
          - usernamePassword:
              scope: GLOBAL
              id: "dockerhub-creds"
              username: "${DOCKER_HUB_USER}"
              password: "${DOCKER_HUB_PASS}"
              description: "Docker Hub Login Credentials"
          # Used for string interpolation (image tagging) in the pipeline
          - string:
              scope: GLOBAL
              id: "dockerhub-username"
              secret: "${DOCKER_HUB_USER}"
              description: "Docker Hub Username String"

jobs:
  - script: >
      pipelineJob('Domain-Monitoring-CI') {
        definition {
          cpsScm {
            scm {
              git {
                remote { url('https://github.com/Tomer-ui/domain-monitor-system2.git') }
                branch('main')
              }
            }
            scriptPath('Jenkinsfile')
          }
        }
      }